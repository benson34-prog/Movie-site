<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé¨ Social Movie Catalog</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #333;
            padding: 20px;
            text-align: center;
            border-bottom: 5px solid #e50914;
        }
        h1 {
            margin: 0;
            color: #fff;
        }
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: auto;
        }
        /* --- User Info Bar --- */
        #userInfo {
            background-color: #333;
            padding: 10px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #userNameInput {
            padding: 8px;
            border: 1px solid #555;
            border-radius: 4px;
            background-color: #444;
            color: white;
            width: 150px;
        }
        #addMovieBtn {
            background-color: #e50914;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
            box-sizing: border-box;
            margin-left: 10px;
        }
        #addMovieBtn:hover {
            background-color: #ff3333;
        }

        /* --- Movie Grid Layout --- */
        #movieCatalog {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding-top: 20px;
        }
        .movie-card {
            background-color: #242424;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .movie-image-container {
            width: 100%;
            height: 400px;
            overflow: hidden;
        }
        .movie-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .movie-info {
            padding: 15px;
            flex-grow: 1;
        }
        .movie-info h3 {
            margin-top: 0;
            color: #e50914;
        }

        /* --- Likes Bar --- */
        .interaction-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px 15px;
        }
        .like-button {
            background: none;
            border: 1px solid #e50914;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .like-button:hover {
            background-color: #e50914;
        }
        .like-button.liked {
            background-color: #e50914;
        }

        /* --- Comment Section Styling --- */
        .comments-section {
            background-color: #111;
            padding: 15px;
            border-top: 1px solid #444;
        }
        .comments-list {
            list-style: none;
            padding: 0;
            margin: 0 0 10px 0;
            max-height: 150px;
            overflow-y: auto;
            border-bottom: 1px dashed #333;
            padding-bottom: 10px;
        }
        .comment {
            background-color: #2a2a2a;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 4px;
            font-size: 0.85em;
            color: #ddd;
        }
        .comment-author {
            font-weight: bold;
            color: #ffc107;
            margin-right: 5px;
        }
        .comment-input-container {
            display: flex;
            gap: 10px;
        }
        .comment-input {
            flex-grow: 1;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #555;
            background-color: #333;
            color: white;
        }
        .comment-submit-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .comment-submit-btn:hover {
            background-color: #0056b3;
        }

        /* --- Modal (Popup for Adding Movie) --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.7); 
            padding-top: 60px;
        }
        .modal-content {
            background-color: #242424;
            margin: 5% auto; 
            padding: 30px;
            border: 1px solid #555;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.8);
        }
        .modal-content label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        .modal-content input[type="text"], 
        .modal-content textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #555;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #333;
            color: white;
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        #submitMovieBtn {
            background-color: #e50914;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #submitMovieBtn:hover {
            background-color: #ff3333;
        }

        /* --- Responsiveness --- */
        @media (max-width: 768px) {
            #movieCatalog {
                grid-template-columns: 1fr;
            }
            #userInfo {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            #userNameInput {
                width: 100%;
            }
            #addMovieBtn {
                margin-left: 0;
            }
            .modal-content {
                width: 90%;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Social Movie Catalog ‚ù§Ô∏è</h1>
    </header>

    <div class="container">
        <div id="userInfo">
            <div>Logged in as: <input type="text" id="userNameInput" placeholder="Enter your name"></div>
            <button id="addMovieBtn">‚ûï Add a New Movie</button>
        </div>

        <div id="movieCatalog">
            </div>
    </div>

    <div id="addMovieModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Add New Movie</h2>
            <form id="movieForm">
                <label for="movieTitle">Title:</label>
                <input type="text" id="movieTitle" required>

                <label for="movieImageUrl">Image URL (Poster):</label>
                <input type="text" id="movieImageUrl" required>

                <label for="movieDescription">Description:</label>
                <textarea id="movieDescription" rows="4" required></textarea>

                <button type="submit" id="submitMovieBtn">Add Movie to Catalog</button>
            </form>
        </div>
    </div>

    <script>
        const movieCatalog = document.getElementById('movieCatalog');
        const addMovieBtn = document.getElementById('addMovieBtn');
        const modal = document.getElementById('addMovieModal');
        const closeBtn = document.getElementsByClassName('close-btn')[0];
        const movieForm = document.getElementById('movieForm');
        const userNameInput = document.getElementById('userNameInput');

        // --- Data Structure ---
        // Comment structure: {author: "User Name", text: "Comment text"}
        // Movie structure: {id: 1, title: "...", url: "...", description: "...", comments: [], likes: 0}
        
        let movies = JSON.parse(localStorage.getItem('socialMovieCatalog')) || [
            { id: 1, title: "The Matrix", url: "https://via.placeholder.com/300x450?text=The+Matrix+Poster", description: "A computer hacker learns from mysterious rebels about the true nature of his reality.", comments: [{author: "Neo", text: "Great classic!"}], likes: 0 },
            { id: 2, title: "Inception", url: "https://via.placeholder.com/300x450?text=Inception+Poster", description: "A thief who steals secrets through dream-sharing technology.", comments: [{author: "Cobb", text: "Mind-bending plot."}], likes: 0 }
        ];

        let userName = localStorage.getItem('currentUserName') || 'Guest';
        userNameInput.value = userName;
        
        // --- Core Data Functions ---

        function saveMovies() {
            localStorage.setItem('socialMovieCatalog', JSON.stringify(movies));
        }

        // Save user name whenever it changes
        userNameInput.addEventListener('input', () => {
            userName = userNameInput.value.trim() || 'Guest';
            localStorage.setItem('currentUserName', userName);
        });

        // --- Rendering Functions ---

        function renderCatalog() {
            movieCatalog.innerHTML = '';
            movies.forEach(movie => {
                const card = createMovieCard(movie);
                movieCatalog.appendChild(card);
            });
        }

        function createMovieCard(movie) {
            const card = document.createElement('div');
            card.className = 'movie-card';
            
            // Check if the current user has liked this movie (for button state)
            const userLikedKey = `liked_${movie.id}_${userName}`;
            const isLiked = localStorage.getItem(userLikedKey) === 'true';

            card.innerHTML = `
                <div class="movie-image-container">
                    <img src="${movie.url}" alt="${movie.title} Poster" class="movie-image">
                </div>
                <div class="movie-info">
                    <h3>${movie.title}</h3>
                    <p>${movie.description}</p>
                </div>

                <div class="interaction-bar">
                    <button class="like-button ${isLiked ? 'liked' : ''}" data-movie-id="${movie.id}">
                        <span class="heart-icon">${isLiked ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                        <span class="like-count" data-movie-id="${movie.id}">${movie.likes}</span> Likes
                    </button>
                    <span>ID: ${movie.id}</span>
                </div>

                <div class="comments-section">
                    <h4>Comments:</h4>
                    <ul class="comments-list" id="comments-list-${movie.id}">
                        ${movie.comments.map(c => 
                            `<li class="comment"><span class="comment-author">${c.author}:</span> ${c.text}</li>`
                        ).join('')}
                    </ul>
                    <div class="comment-input-container">
                        <input type="text" class="comment-input" placeholder="Share your thoughts...">
                        <button class="comment-submit-btn" data-movie-id="${movie.id}">Comment</button>
                    </div>
                </div>
            `;
            
            // Attach event listeners
            const commentBtn = card.querySelector(`.comment-submit-btn`);
            commentBtn.addEventListener('click', handleCommentSubmission);

            const likeBtn = card.querySelector(`.like-button`);
            likeBtn.addEventListener('click', handleLike);

            return card;
        }

        // --- Interaction Handlers ---

        function handleCommentSubmission(event) {
            const currentUserName = userNameInput.value.trim();
            if (!currentUserName || currentUserName === 'Guest') {
                alert("Please enter your name in the top bar before commenting.");
                return;
            }

            const movieId = parseInt(event.target.getAttribute('data-movie-id'));
            const inputElement = event.target.previousElementSibling;
            const commentText = inputElement.value.trim();

            if (commentText) {
                const movie = movies.find(m => m.id === movieId);
                if (movie) {
                    const newComment = { author: currentUserName, text: commentText };
                    movie.comments.push(newComment);
                    saveMovies();
                    
                    // Update the specific comments list on the page
                    const commentsList = document.getElementById(`comments-list-${movieId}`);
                    const newCommentElement = document.createElement('li');
                    newCommentElement.className = 'comment';
                    newCommentElement.innerHTML = `<span class="comment-author">${newComment.author}:</span> ${newComment.text}`;
                    commentsList.appendChild(newCommentElement);
                    
                    inputElement.value = '';
                    commentsList.scrollTop = commentsList.scrollHeight;
                }
            }
        }

        function handleLike(event) {
            const currentUserName = userNameInput.value.trim();
            if (!currentUserName || currentUserName === 'Guest') {
                alert("Please enter your name in the top bar before liking a movie.");
                return;
            }
            
            const btn = event.currentTarget;
            const movieId = parseInt(btn.getAttribute('data-movie-id'));
            const movie = movies.find(m => m.id === movieId);
            const userLikedKey = `liked_${movieId}_${currentUserName}`;
            
            if (!movie) return;

            // Toggle like state
            if (btn.classList.contains('liked')) {
                // Unlike
                movie.likes = Math.max(0, movie.likes - 1);
                btn.classList.remove('liked');
                btn.querySelector('.heart-icon').textContent = 'ü§ç';
                localStorage.setItem(userLikedKey, 'false');
            } else {
                // Like
                movie.likes += 1;
                btn.classList.add('liked');
                btn.querySelector('.heart-icon').textContent = '‚ù§Ô∏è';
                localStorage.setItem(userLikedKey, 'true');
            }

            // Update the count on the page and in storage
            btn.querySelector('.like-count').textContent = movie.likes;
            saveMovies();
        }

        // --- Modal & Form Logic ---

        movieForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const title = document.getElementById('movieTitle').value;
            const url = document.getElementById('movieImageUrl').value;
            const description = document.getElementById('movieDescription').value;

            const newId = movies.length > 0 ? Math.max(...movies.map(m => m.id)) + 1 : 1;

            const newMovie = {
                id: newId,
                title: title,
                url: url,
                description: description,
                comments: [],
                likes: 0
            };

            movies.push(newMovie);
            saveMovies();

            renderCatalog();

            modal.style.display = 'none';
            movieForm.reset();
        });

        addMovieBtn.onclick = function() { modal.style.display = "block"; }
        closeBtn.onclick = function() { modal.style.display = "none"; }
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Initial setup
        renderCatalog();

    </script>
</body>
</html>